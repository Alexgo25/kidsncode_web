window.levels={0:{cubes:{x:[0,1,2,3,4,5,6,7,8,9,10,11,0,1,2,3,4,5,6,7,8,9,10,11,0,1,2,5,6,7,9,0,6,7,9,7],y:[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,4]},robot:{x:2,y:3,direction:"right"},award:{x:[9,11],y:[4,2],url:["http://cs631829.vk.me/v631829533/2cb3/V3icNf7q5fs.jpg","http://cs624818.vk.me/v624818533/31842/RUu8UoenACM.jpg"]}}},window.properties=window.levels[0],window.helpers={nodes:{body:$(document.body),award:$(".js-award"),robot:$(".js-robot"),win:$(".js-window"),platform:$(".js-platform")},methods:{animations:{awardTop:function(){$(".js-award").animate({top:"-=50"},1500).promise().done(function(){window.helpers.methods.animations.awardBottom()})},awardBottom:function(){$(".js-award").animate({top:"+=50"},1500).promise().done(function(){window.helpers.methods.animations.awardTop()})},robotWalk:function(o){!function t(e,n){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-walk-'+o+"-"+e+'"></span>'),9>e&&(2===n||1===n)?(e++,t(e,n)):2===n&&t(1,1)},50)}(1,2)},robotReverse:function(o){"left"===o?!function t(o){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-turn-'+o+'"></span>'),7>o&&(o++,t(o))},101)}(1):"right"===o&&!function e(o){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-turn-'+o+'"></span>'),o>1&&(o--,e(o))},101)}(7)},robotPush:function(o){var t=function(o,e){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-push-'+e+"-"+o+'"></span>'),o>1&&(o--,t(o,e))},50)};!function e(o,n){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-push-'+n+"-"+o+'"></span>'),5>o?(o++,e(o,n)):t(5,n)},50)}(1,o)},robotMistake:function(o){var t=function(e){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-mistake-'+e+'"></span>'),9>e?(e++,t(e)):n(5,o)},100)},e=function(o,n){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-turn-facing-'+n+"-"+o+'"></span>'),5>o?(o++,e(o,n)):t(1)},100)},n=function(o,t){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-turn-facing-'+t+"-"+o+'"></span>'),o>1&&(o--,n(o,t))},100)};e(1,o)},robotJump:function(o){var t=function(o,e){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-jump-'+e+"-"+o+'"></span>'),o>1&&(o--,t(o,e))},100)};!function e(o,n){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-jump-'+n+"-"+o+'"></span>'),8>o?(o++,e(o,n)):setTimeout(function(){t(8,n)},300)},100)}(1,o)},robotTurnFacing:function(o){!function t(o,e){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-turn-facing-'+e+"-"+o+'"></span>'),5>o&&(o++,t(o,e))},100)}(1,o)},robotTurnFacingBack:function(o){!function t(o,e){setTimeout(function(){window.helpers.nodes.robot.find(".js-robot-model").html('<span class="sprite icon-robot-turn-facing-'+e+"-"+o+'"></span>'),o>1&&(o--,t(o,e))},100)}(5,o)}},getCubesCordinates:function(){for(var o=window.helpers.nodes.win.find(".js-platform-cube"),t={x:[],y:[]},e=0;e<o.length;e++)t.x.push(Math.abs(parseInt(o.eq(e).css("left"))/100)),t.y.push(Math.abs((parseInt(o.eq(e).css("top"))+100)/-100));return t},getRobotCordinates:function(){var o={},t=parseInt(window.helpers.nodes.robot.css("left")),e=parseInt(window.helpers.nodes.robot.css("top"));return o.x=(t-20)/100,o.y=(e+133)/-100,o},getCubeNode:function(o,t){for(var e=100*o+"px",n=-100*t-100+"px",s=window.helpers.nodes.platform.find(".js-platform-cube"),i=0;i<s.length;i++)if(s.eq(i).css("left")===e&&s.eq(i).css("top")===n)return s.eq(i)},setZindexes:function(o){for(var t,e,n=0,s=window.helpers.methods.getRobotCordinates(),i=window.helpers.methods.getCubesCordinates(),r="horizontal"===o?100*s.y+s.x:100*s.x+s.y;n<i.y.length;n++)e="horizontal"===o?100*i.y[n]+i.x[n]:100*i.x[n]+i.y[n],t=window.helpers.methods.getCubeNode(i.x[n],i.y[n]),t.css("zIndex",e);window.helpers.nodes.robot.find(".js-robot-model").css("zIndex",r)},setFutureZ:function(o){var t=100*((o.top+133)/-100)+(o.left-20)/100;window.helpers.nodes.robot.find(".js-robot-model").css("zIndex",t)}}},function(o,t,e,n){var s={body:o(e.body),robot:o(".js-robot"),program:o(".js-program"),controls:o(".js-controls"),loop:o(".js-loop"),platform:o(".js-platform")},i={actionIndex:0},r=t.helpers.methods,a=(t.helpers.methods.animations,t.properties,{setEvents:function(){s.controls.on({click:function(){a.setAction(),s.robot.removeClass("is-select")}},".js-controls-start")},setAction:function(){var o=s.program.find(".js-program-actions").children(),t=i.actionIndex;if(o.removeClass("is-selected"),o.eq(t).hasClass("js-program-action")){switch(o.eq(t).data("action")){case"walk":a.robotWalk();break;case"reverse":a.robotReverse();break;case"push":a.robotPush();break;case"jump":a.robotJump()}o.eq(t).addClass("is-selected")}i.actionIndex++},robotWalk:function(){var o="right"===s.robot.data("direction")?"+":"-",t=a.checkWalk(o+1);return"jump"===t.special?void a.robotJump():void(0===t.errors?(r.animations.robotWalk(s.robot.data("direction")),s.robot.animate({left:o+"=100px"},1e3,function(){r.setZindexes("horizontal"),a.setAction()})):(r.animations.robotMistake(s.robot.data("direction")),setTimeout(function(){a.setAction()},2e3)))},robotReverse:function(){var o=s.robot.data("direction");"right"===o?(r.animations.robotReverse("left"),s.robot.data("direction","left")):(r.animations.robotReverse("right"),s.robot.data("direction","right")),setTimeout(function(){a.setAction()},1e3)},robotPush:function(){var o,t="right"===s.robot.data("direction")?"+":"-",e=a.checkPush(t+1);e.exist&&e.pushable?(r.animations.robotPush(s.robot.data("direction")),e.direction=t,o=r.getCubeNode(e.x,e.y),e.fallable?o.animate({left:t+"=100px"},1e3,function(){r.setZindexes("vertical"),o.animate({top:"+="+100*e.fallRange+"px"},250,function(){r.setZindexes("horizontal"),a.setAction()})}):o.animate({left:t+"=100px"},1e3,function(){r.setZindexes("horizontal"),a.setAction()})):(r.animations.robotMistake(s.robot.data("direction")),setTimeout(function(){a.setAction()},2e3))},robotJump:function(){var t,e="right"===s.robot.data("direction")?"+":"-",n=a.checkJump(e+1);n.possibility?(t={start:{x:n.start.left,y:n.start.top,angle:n.start.angle},end:{x:n.end.left,y:n.end.top-1,angle:n.end.angle,length:n.end.length}},r.animations.robotJump(s.robot.data("direction")),setTimeout(function(){setTimeout(function(){r.setFutureZ(n.end)},600),s.robot.animate({path:new o.path.bezier(t)},1e3,function(){r.setZindexes("horizontal"),setTimeout(function(){a.setAction()},400)})},400)):(r.animations.robotMistake(s.robot.data("direction")),setTimeout(function(){a.setAction()},2e3))},checkWalk:function(o){for(var t=r.getRobotCordinates(),e=r.getCubesCordinates(),s={errors:0,special:null},i=0;i<e.x.length;i++)t.x+parseInt(o)===e.x[i]&&t.y===e.y[i]&&s.errors++;return r.getCubeNode(t.x+parseInt(o),t.y-1)===n&&(s.special="jump"),s},checkPush:function(o){for(var t=r.getRobotCordinates(),e=r.getCubesCordinates(),n={exist:!1,pushable:!0,fallable:!0,x:null,y:null},s=0;s<e.x.length;s++)t.x+parseInt(o)===e.x[s]&&t.y===e.y[s]&&(n.exist=!0,n.x=e.x[s],n.y=e.y[s]);for(var i=0;i<e.x.length;i++)e.x[i]===n.x+1&&e.y[i]===n.y?n.pushable=!1:e.x[i]===n.x&&e.y[i]===n.y+1?n.pushable=!1:e.x[i]===n.x+1&&e.y[i]===n.y-1&&(n.fallable=!1);if(n.fallable){for(var a=0,l=0;l<e.x.length;l++)e.x[l]===n.x+1&&e.y[l]<n.y&&a++;n.fallRange=n.y-a}return n.node=r.getCubeNode(n.x,n.y),n},checkJump:function(o){for(var t=r.getRobotCordinates(),e=r.getCubesCordinates(),i={possibility:!0,trajectory:"straight",start:{},end:{}},a=0;a<e.x.length;a++)t.x+parseInt(o)===e.x[a]&&t.y===e.y[a]-1?i.possibility=!1:t.x+parseInt(o)===e.x[a]&&t.y===e.y[a]&&(i.trajectory="to-top");return r.getCubeNode(t.x+parseInt(o),t.y-2)===n&&t.y>2&&(i.possibility=!1),r.getCubeNode(t.x+parseInt(o),t.y-1)===n&&(i.trajectory="to-bottom",1===t.y&&(i.possibility=!1)),i.start.left=parseInt(s.robot.css("left")),i.start.top=parseInt(s.robot.css("top")),i.end.left=parseInt(s.robot.css("left"))+100*parseInt(o),i.start.angle=-50*parseInt(o),i.end.angle=100*parseInt(o),i.end.length=1,"to-top"===i.trajectory?i.end.top=parseInt(s.robot.css("top"))-100:"to-bottom"===i.trajectory?(i.end.top=parseInt(s.robot.css("top"))+100,i.start.angle=120*parseInt(o),i.end.angle=50*parseInt(o),i.end.length=2.2):i.end.top=parseInt(s.robot.css("top")),i}});a.setEvents()}(jQuery,window,document),function(o,t,e,n){var s={body:o(e.body),platform:o(".js-platform"),robot:o(".js-robot"),award:o(".js-award")},i=t.properties,r=t.helpers.methods,a={init:function(){a.setCubes(),a.setRobot(),a.setAward(),r.setZindexes("horizontal"),r.animations.awardTop()},setRobot:function(){s.robot.data("direction",i.robot.direction),s.robot.css({left:20+100*i.robot.x+"px",top:-100*i.robot.y-133+"px"}),s.robot.find(".js-robot-model").html('<span class="sprite icon-robot-'+i.robot.direction+'"></span>')},setCubes:function(){for(var o=i.cubes,t=0;t<o.x.length;t++){var e=100*o.x[t]+"px",n=-100*o.y[t]-100+"px";s.platform.prepend('<div class="window-platform__cube js-platform-cube"style="left: '+e+"; top: "+n+'"><span class="sprite icon-cube"></span></div>')}},setAward:function(){for(var o=0;o<i.award.x.length;o++){var t=40+100*i.award.x[o]+"px",e=-100*i.award.y[o]-100+"px";s.platform.append('<div class="window-award js-award"style="left: '+t+"; top: "+e+"; background-image: url("+i.award.url[o]+');"></div>')}}};a.init()}(jQuery,window,document),function(){var o,t,e,n,s,i=$(".js-loop-slider"),r=i.find(".js-loop-slider-left"),a=i.find(".js-loop-slider-right"),l=i.find(".js-loop-slider-elements"),d=$(document.body),p=!0;d.on({click:function(){if("right-false"!==s()&&p){p=!1,o=i.find(".js-loop-slider-element");for(var r=0;r<o.length;r++)o.eq(r).hasClass("is-active")?(t=o.eq(r),e=t.data("index"),n='<div class="panel-controls__loop-element js-loop-slider-element is-active" data-index="'+(e+1)+'">'+(e+1)+"</div>",t.css("marginLeft","-100%").removeClass("is-active").addClass("is-left"),l.append(n)):(o.eq(r).hasClass("is-left")||o.eq(r).hasClass("is-right"))&&o.eq(r).remove();s()}}},".js-loop-slider-right"),d.on({click:function(){if("left-false"!==s()&&p){p=!1,o=i.find(".js-loop-slider-element");for(var r=0;r<o.length;r++)o.eq(r).hasClass("is-active")?(t=o.eq(r),e=t.data("index"),n='<div class="panel-controls__loop-element js-loop-slider-element is-active is-margin-left" data-index="'+(e-1)+'">'+(e-1)+"</div>",l.prepend(n),t.removeClass("is-active").addClass("is-right"),setTimeout(function(){i.find(".is-margin-left").removeClass("is-margin-left")},2)):(o.eq(r).hasClass("is-left")||o.eq(r).hasClass("is-right"))&&o.eq(r).remove();s()}}},".js-loop-slider-left"),d.on({transitionend:function(){p=!0}},".js-loop-slider-element"),(s=function(){o=i.find(".js-loop-slider-element");for(var t=0;t<o.length;t++)if(o.eq(t).hasClass("is-active")){if(1===o.eq(t).data("index"))return r.addClass("is-disabled"),"left-false";if(20===o.eq(t).data("index"))return a.addClass("is-disabled"),"right-false"}else r.removeClass("is-disabled"),a.removeClass("is-disabled")})()}(),function(o,t,e,n){var s={body:o(e.body),robot:o(".js-robot"),program:o(".js-program"),controls:o(".js-controls"),loop:o(".js-loop")},i=t.helpers.methods,r={setEvents:function(){s.robot.on({click:function(){o(this).toggleClass("is-select"),o(this).hasClass("is-select")?i.animations.robotTurnFacing(s.robot.data("direction")):i.animations.robotTurnFacingBack(s.robot.data("direction"))}}),s.robot.on({click:function(t){t.preventDefault(),t.stopPropagation();var e=o(this).data("action"),n=r.getActionName(e),i='<div class="panel-program__action js-program-action" data-action="'+e+'">'+n+"</div>";s.program.find(".js-program-actions").append(i)}},".js-robot-action"),s.program.on({click:function(){o(this).parents(".js-program-loop").length||(o(this).toggleClass("is-loopy"),r.openLoopControl())}},".js-program-action"),s.loop.on({click:function(){var o,t=s.program.find(".js-program-action.is-loopy"),e=t.first(),n=s.controls.find(".js-loop-slider-element.is-active").data("index");e.before('<div class="panel-program__loop js-program-loop is-new" data-index="'+n+'"><div class="panel-program__loop-angle js-program-loop-angle"><div class="panel-program__loop-horizontal"></div><div class="panel-program__loop-vertical js-program-loop-angle-vertical"></div><div class="panel-program__loop-title js-program-loop-angle-title"></div></div></div>'),o=s.program.find(".js-program-loop.is-new"),o.append(t.removeClass("is-loopy")),s.controls.removeClass("is-loop"),setTimeout(function(){o.find(".js-program-loop-angle-title").append("ПОВТОРИТЬ x"+n),o.find(".js-program-loop-angle").addClass("is-open"),o.find(".js-program-loop-angle-vertical").css("min-height",48+40*t.length+"px"),o.removeClass("is-new")},500)}},".js-loop-submit"),s.loop.on({click:function(){variables.newLoop=[],s.controls.removeClass("is-loop")}},".js-loop-cancel")},openLoopControl:function(){var o=s.program.find(".js-program-action.is-loopy");o.length>0?s.controls.addClass("is-loop"):s.controls.removeClass("is-loop")},getActionName:function(o){switch(o){case"walk":return"шагнуть";case"reverse":return"повернуть";case"push":return"толкнуть";case"jump":return"прыгнуть"}}};r.setEvents()}(jQuery,window,document);